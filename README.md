# satellite-host

This repo is used to create a satellite-host usb key.

## System Configuration

### Hardware
Prereq, an 8 core (16 thread) 32GB x86 system with 1TB HD.

### Network Bridge
You'll need to configure the primary network adapter of the host in bridge mode. The following network configs are an example of public bridge mode. Details gathered from:
https://www.linux-kvm.org/page/Networking#Public_Bridge

```
# /etc/sysconfig/network-scripts/ifcfg-br0

# Generated by parse-kickstart
IPV6INIT="yes"
BRIDGING_OPTS="priority=32768"
NAME="Bridge connection br0"
IPV6_AUTOCONF="yes"
BOOTPROTO="dhcp"
STP="yes"
DEVICE="br0"
TYPE="Bridge"
ONBOOT="yes"
```

```
# /etc/sysconfig/network-scripts/ifcfg-eno1

# Generated by parse-kickstart
BRIDGE="br0"
NAME="br0 slave 1"
# Assumes linked adapter is eno1. Be sure you remove the ifcfg-eno1 config as well
DEVICE="eno1"
TYPE="Ethernet"
ONBOOT="yes"
```

### Network access
you will need outbound access to the public internet


## Host Virtualization and Setup
You will need to download rhel-server-7.9-x86_64-kvm.qcow2 and place a copy of it named sat-base.qcow2 in the /host/satellite directory. Once you have that image in place then you will also need to place a copy of your satellite host attach script in /home/satellite/host-attach.sh Make sure that you modify the host attach script to include:

```
subscription-manager register --force --username=<RH Username> --password=<RH Password>
subscription-manager attach --auto
subscription-manager refresh
subscription-manager repos --enable rhel-server-rhscl-7-rpms
subscription-manager repos --enable rhel-7-server-optional-rpms
subscription-manager repos --enable rhel-7-server-rh-common-rpms
subscription-manager repos --enable rhel-7-server-supplementary-rpms
subscription-manager repos --enable rhel-7-server-extras-rpms
rpm --import /etc/pki/rpm-gpg/*
```

Right after
```
API_URL="https://origin.us-east.containers.cloud.ibm.com/"
```

## Future
I have some scripting that I am working on that will bake all of this voodoo into a bootable image that you can run on any hardware of the right spec and it will automatically image RHEL onto the baremetal and virtualize it.
